#!/usr/bin/env sh

# Default configuration
PACMAN_UPDATE=yes
AUR_UPDATE=no
AUR_SRC_DIRECTORY=~/.aur
PACCACHE_CLEAR=no
PACCACHE_KEEP=2
FLATPAK_UPDATE=no

CONFIG_FILE_GLOBAL="/etc/k-arch-update.conf"

if [ -r "$CONFIG_FILE_GLOBAL" ]
then
    source "$CONFIG_FILE_GLOBAL"
fi

if [ "$PACMAN_UPDATE" = "yes" ]
then
    sudo pacman -Syu
fi

if [ "$AUR_UPDATE" = "yes" ]
then
    [[ ! -d "$AUR_SRC_DIRECTORY" ]] && mkdir -p "$AUR_SRC_DIRECTORY"
    for file in $AUR_SRC_DIRECTORY/*
    do
        if [ -d "$file" ]
        then
            cd "$file"
            pwd
            makepkg -si --needed --noconfirm
        fi 
    done
fi

if [ "$PACCACHE_CLEAR" = "yes" ]
then
    sudo paccache -r -k $PACCACHE_KEEP
fi

if [ "$FLATPAK_UPDATE" = "yes" ]
then
    sudo flatpak update -y
fi